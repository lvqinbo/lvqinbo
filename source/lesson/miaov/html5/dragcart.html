<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>拖拽购物车功能</title>
	<style>
	ul{list-style: none; margin:0; padding:0;}
	body{font: 400 12px/16px "微软雅黑"; }
	#wrap{width: 960px; margin: 20px auto;}
	#bookBox{width: 100%;}
	.book_list{width: 848px; margin: 0 auto; overflow: hidden;}
	.book_e {width: 180px; padding: 10px; margin: 10px 10px 10px 0; background: #f1f1f1; border:1px solid #f0f0f0; float: left;}
	.book_e img{border:none; vertical-align: top; width: 180px;}
	.book_e p {margin:10px 0; height: 30px; width: 180px; color: #333; }
	.book_e span{width: 200px; height: 30px; color: red; }
	.book_e a{width: 180px; height: 30px; color: #f30; display: block; text-align: right; padding-right: 20px; text-decoration: none;}
	
	#cart{width: 100%; height: 210px; border:1px solid #f0f0f0; text-align: left;}

	.cart_list {margin:0; height: 30px; padding:5px 10px; border-bottom:1px dashed #ccc; }
	.cart_list span{ display: inline-block; text-align: center;}
	.book_num{width: 30px; height: 30px; line-height: 30px; background: red; background: #E85DF2; color: #fff; border-radius:50%; }
	.book_title{width: 700px;}
	.book_money{width: 60px;  }
	#moneyTotal{height: 30px; line-height: 30px; padding-right:20px; text-align: right; }
	</style>
	<link rel="stylesheet" href="../../code.css">
	<script src="../../ajax.js"></script>
	<script src="../../readcode.js"></script>
	<script>
	window.onload = function(){
		var oCodeList = getByClass(document,'codelist')[0];
		readCode('dragcart.js',oCodeList);
		var oBox = document.getElementById('bookBox');
		var aBook = getByClass(oBox,'book_e');
		var oCart = document.getElementById('cart');
		var iNum = 0; 
		var allMoney = null;
		var obj = {};
		var arrColor = ['#FF4500','#FF4040','#EE1289','#C0FF3E','#8B8B00','#FF1493'];

		for (var i = 0; i < aBook.length; i++) {
			aBook[i].index = i;
	
			aBook[i].draggable = true;
			aBook[i].ondragstart = function(ev)
			{
				var oP = this.getElementsByTagName('p')[0];
				var oSpan = this.getElementsByTagName('span')[0];
				var ev = ev || event;
				ev.dataTransfer.setData('title',oP.innerHTML);
				ev.dataTransfer.setData('money',oSpan.innerHTML);
			}
			
			oCart.ondragover = function(ev)
			{
				var ev = ev ||event;
				ev.preventDefault();
			}
			oCart.ondrop = function(ev)
			{
				var ev = ev || event;
				ev.preventDefault();
				var oTitle = ev.dataTransfer.getData('title');
				var oMoney = ev.dataTransfer.getData('money');

				if(!obj[oTitle])
				{
					var oCloumn = document.createElement('p');
					oCloumn.className = 'cart_list';
					
					var oNum = document.createElement('span');
					oNum.innerHTML = 1;
					oNum.className = 'book_num';
					oNum.style.background = arrColor[iNum];
					oCloumn.appendChild(oNum);

					var oT = document.createElement('span');
					oT.innerHTML = oTitle;
					oT.className = 'book_title';
					oCloumn.appendChild(oT);
					
					var oM = document.createElement('span');
					oM.innerHTML = oMoney;
					oM.className = 'book_money';
					oCloumn.appendChild(oM);

					oCart.appendChild(oCloumn);
					obj[oTitle] = 1;
				}
				else
				{
					var oBox1 = document.getElementsByClassName('book_num');
					var oBox2 = document.getElementsByClassName('book_title');

					for (var i = 0; i < oBox2.length; i++) {
						if(oBox2[i].innerHTML == oTitle)
						{
							oBox1[i].innerHTML = parseInt(oBox1[i].innerHTML)+1;
						}
					};
				}
				if(!allMoney){
					allMoney = document.createElement('div');
					allMoney.id = 'moneyTotal';
				}
				iNum += parseFloat(oMoney)*100;
				allMoney.innerHTML = iNum/100+'元';
				oCart.appendChild(allMoney);
			}

		};
	}
	function getByClass(oParent,sClass)
	{
		var oEle = oParent.getElementsByTagName('*');
		var result = [];

		for (var i = 0; i < oEle.length; i++) {
			if(oEle[i].className == sClass)
			{
				result.push(oEle[i]);
			}
		};
		return result;
	}
	</script>
</head>
<body>
<div id="wrap">
	<div id="bookBox">
		<ul class="book_list">
			<li class="book_e">
				<img src="img/1.jpg" alt="图片1">
				<p>达洋猫绘本系列 第1辑（共7册）精装典藏</p>
				<span>12￥</span>
				<a href="javascript:;">购买</a>
			</li>
			<li  class="book_e">
				<img src="img/2.jpg" alt="图片1">
				<p>小莲游莫奈花园系列绘本</p>
				<span>58.8￥</span>
				<a href="javascript:;">购买</a>
			</li>
			<li class="book_e">
				<img src="img/3.jpg" alt="图片1">
				<p>弗洛拉和火烈鸟系列：全2册</p>
				<span>22￥</span>
				<a href="javascript:;">购买</a>
			</li>
			<li  class="book_e">
				<img src="img/4.jpg" alt="图片1">
				<p>绘本窗边的小豆豆</p>
				<span>18.8￥</span>
				<a href="javascript:;">购买</a>
			</li>
		</ul>
	</div>
	<div id="cart">
	<!-- 
		<p class="cart_list">
			<span class="book_num">1</span>
			<span class="book_title">拖拽购物车功能</span>
			<span class="book_money">12￥</span>
		</p>
	<div id="moneyTotal">111</div>-->
	</div>
</div>
	<div class="codebox"><pre><ol class="codelist"></ol></pre></div>
</body>
</html>