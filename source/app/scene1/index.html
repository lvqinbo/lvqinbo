<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=640,user-scalable=no,target-densityDpi=device-dpi">
	<title>微信场景一</title>
	<style type="text/css">
	*{margin: 0; padding: 0;}
	li{list-style: none;}
	#main{width: 640px; height: 960px; position: relative; overflow: hidden;}
	#c1{width: 100%; height: 100%; position: absolute; left: 0; top: 0; z-index: 19;}

	#list{}
	#list >li{width: 100%; height: 100%; position: absolute; left: 0; top: 0; background-size: cover; display: none; z-index: 5;}
	#list >li.zIndex{z-index: 6;}
	#list >li:nth-of-type(1){background-image: url(img/b.png);}
	#list >li:nth-of-type(2){background-image: url(img/c.png);}
	#list >li:nth-of-type(3){background-image: url(img/d.png);}
	#list >li:nth-of-type(4){background-image: url(img/e.png); }
	#list >li:nth-of-type(5){background-image: url(img/ad1.png);}
	#list >li:nth-of-type(6){background-image: url(img/ad2.png);}
	#list >li:nth-of-type(7){background-image: url(img/ad3.png);}
	#list >li:nth-of-type(8){background-image: url(img/ad4.png);}
	
	#list .page1{font-size: 1.8em; line-height: 150%; color: #fff; left: 20%; top: 60%; position: absolute;}

	#list .page2 li{width: 90px; height: 90px; position: absolute; margin-left: -45px;}
	#list .page2 li:nth-of-type(1){background: url(img/c1.png); left: 50%; top: 32%;}
	#list .page2 li:nth-of-type(2){background: url(img/c2.png); left: 50%; top: 74%;}
	#list .page2 li:nth-of-type(3){background: url(img/c3.png); left: 25%; top: 42%;}
	#list .page2 li:nth-of-type(4){background: url(img/c4.png); left: 72%; top: 42%;}
	#list .page2 li:nth-of-type(5){background: url(img/c5.png); left: 23%; top: 64%;}
	#list .page2 li:nth-of-type(6){background: url(img/c6.png); left: 77%; top: 64%;}

	#list .page2 li.selected{left: 50%; top: 50%;}
	#list .page3{width: 460px; height: 222px; background: url(img/d1.png); position: absolute; left: 50%; top: 60%; margin-left: -230px;}

	#list .page4 li{position: absolute; color: #fff; font-size: 1.4em; padding: 15px; border: 1px solid #fff; border-radius: 5px; box-shadow: 0 0 15px #f0f0f0; word-break: break-all; overflow: hidden;}
	#list .page4 li:nth-of-type(1){width: 200px; height: 250px; left: 8%; top: 14%;}
	#list .page4 li:nth-of-type(2){width: 280px; height: 160px; left: 50%; top: 18%;}
	#list .page4 li:nth-of-type(3){width: 110px; height: 270px; left: 76%; top: 42%;}
	#list .page4 li.active{width: 0; height: 0; opacity: 0;}
	
	#loading{width: 100%; height: 100%; position: absolute; left: 0; top: 0; text-align: center; z-index: 20; background: transparent;}
	#loading p{font-size: 2em; color: #1A8BF6; top: 45%; position: relative;}
	#loading ul{width: 100px; height: 40px; position: absolute; top: 40%; left: 40%;}
	#loading ul li{width: 5px; height: 40px; background: #1A8BF1; float: left; margin-right: 10px; -webkit-animation: 2s loadingMove linear infinite; animation: 2s loadingMove linear infinite;}
	#loading ul li:nth-child(1){-webkit-animation-delay: -0.2s; animation-delay: -0.2s;}
	#loading ul li:nth-child(2){-webkit-animation-delay: -0.4s; animation-delay: -0.4s;}
	#loading ul li:nth-child(3){-webkit-animation-delay: -0.6s; animation-delay: -0.6s;}
	#loading ul li:nth-child(4){-webkit-animation-delay: -0.8s; animation-delay: -0.8s;}
	#loading ul li:nth-child(5){-webkit-animation-delay: -1s; animation-delay: -1s;}
	#loading ul li:nth-child(6){-webkit-animation-delay: -1.2s; animation-delay: -1.2s;}

	@keyframes loadingMove{
		0%{transform: scale(1);}
		50%{transform: scale(.2);}
		100%{transform: scale(1);}
	}
	@-webkit-keyframes loadingMove{
		0%{-webkit-transform: scale(1);}
		50%{-webkit-transform: scale(.2);}
		100%{-webkit-transform: scale(1);}
	}

	#arrow{width: 90px; height: 52px; background: url(img/arr.png); position: absolute; left: 50%; bottom: 20px; margin-left: -45px; z-index: 8; -webkit-animation: 1s arrowMove infinite; animation: 1s arrowMove infinite;}

	#music{width: 70px; height: 70px; background: url(img/music.png); background-size: cover; position: absolute; top: 2%; right: 20px; z-index: 8; display: none;}
	#music.roll{ -webkit-animation: 1s musicMove linear infinite; animation: 1s musicMove linear infinite;}

	@keyframes arrowMove{
		0%{opacity: 0; transform: translate(0,0);}
		50%{opacity: 1; transform: translate(0,-30px);}
		100%{opacity: 0; transform: translate(0,-50px);}
	}
	@-webkit-keyframes arrowMove{
		0%{opacity: 0; -webkit-transform: translate(0,0);}
		50%{opacity: 1; -webkit-transform: translate(0,-30px);}
		100%{opacity: 0; -webkit-transform: translate(0,-50px);}
	}

	@keyframes musicMove{
		0%{transform: rotateZ(0deg);}
		100%{transform: rotateZ(360deg);}
	}
	@-webkit-keyframes musicMove{
		0%{-webkit-transform: rotateZ(0);}
		100%{-webkit-transform: rotateZ(720deg);}
	}
	</style>
	<script type="text/javascript" src="jquery-2.1.3.min.js"></script>
	<script type="text/javascript">
	$(document).on('touchmove',function(ev){
		ev.preventDefault();
	});
	$(function(){
		var $main = $('#main');
		var $list = $('#list');
		var $li = $list.find('>li');
		var desW = 640;
		var desH = 960;
		var $music = $('#music');
		var $audio = $('#audio1');
		var viewHeight = $(window).height();

		$main.css('height',viewHeight);
		
		function nowWidth(){
			var w = desW/desH * viewHeight;
			w = w > desW ? w : desW;
			return w;
		}

		loadingSource();
		slideCanvas();
		slideList();

		function slideCanvas(){
			var oC = $('#c1').get(0);
			var oGc = oC.getContext('2d');

			var iBtn = true;

			 oC.height = viewHeight;

			var objImg = new Image();
			objImg.src = 'img/a.png';
			
			objImg.onload = function(){
				oGc.drawImage(objImg,(desW - nowWidth())/2,0,nowWidth(),viewHeight);

				$(oC).on('touchstart',function(ev){
					var touch = ev.originalEvent.changedTouches[0];
					var x = touch.pageX - $(this).offset().left;
					var y = touch.pageY - $(this).offset().top;

					oGc.fillStyle = 'red';
					oGc.lineWidth = '60';
					oGc.lineCap = 'round';
					oGc.globalCompositeOperation = 'destination-out';

					if(iBtn){
						iBtn = false;
						oGc.beginPath();
						oGc.moveTo(x,y);
						oGc.lineTo(x+1,y+1);
					}else{
						oGc.lineTo(x,y);
					}
					oGc.stroke();
				
					$(oC).on('touchmove.move',function(ev){
						var touch = ev.originalEvent.changedTouches[0];
						var x = touch.pageX - $(this).offset().left;
						var y = touch.pageY - $(this).offset().top;
						oGc.lineTo(x,y);
						oGc.stroke();
					})
					$(oC).on('touchend.move',function(ev){
						var touch = ev.originalEvent.changedTouches[0];
						var dataImage = oGc.getImageData(0,0,oC.width,oC.height);
						var allPX = dataImage.width * dataImage.height;

						var iNum = 0;

						for(var i = 0; i < allPX; i++){
							if(dataImage.data[i*4+3] == 0){
								iNum++;
							}
						}
						if(iNum > allPX/3){
							$(oC).animate({opacity: 0},1000,function(){
								$(this).remove();
								createAnimate[0].inAnimate();
								loadMusic();
							});
						}

						$(oC).off('move');
					})
				})
			}
		}

		function slideList(){
			$li.css('backgroundPosition',((desW - nowWidth())/2)+'px 0');
			var downY = 0;
			var step = 1/4;
			var nowIndex = 0;
			var brotherIndex = 0;
			var iBtn = true;

			$li.on('touchstart',function(ev){
				if(!iBtn) return;
				iBtn = false;
				var touch = ev.originalEvent.changedTouches[0];
				downY = touch.pageY;
				nowIndex = $(this).index();

				$li.on('touchmove',function(ev){
					var touch = ev.originalEvent.changedTouches[0];
					$(this).siblings().hide();

					if(touch.pageY < downY){ //向上
						brotherIndex = nowIndex == $li.length - 1 ? 0 : nowIndex + 1;
						$li.eq(brotherIndex).css('transform','translate(0,'+(viewHeight + touch.pageY - downY)+'px)');

					}else if(touch.pageY > downY){ //向下
						brotherIndex = nowIndex == 0 ? $li.length - 1 : nowIndex - 1;
						$li.eq(brotherIndex).css('transform','translate(0,'+(-viewHeight + touch.pageY - downY)+'px)');
					}else{
						iBtn = true;
					}
					$li.eq(brotherIndex).show().addClass('zIndex');
					$(this).css('transform','translate(0,'+(touch.pageY - downY)*step+'px) scale('+(1-(Math.abs(touch.pageY - downY)/viewHeight * step))+')');
				});
				$li.on('touchend',function(ev){
					var touch = ev.originalEvent.changedTouches[0];

					if(touch.pageY < downY){
						$(this).css('transform','translate(0,'+(-viewHeight * step)+'px) scale('+(1 - step)+')');

					}else if(touch.pageY > downY){
						$(this).css('transform','translate(0,'+(viewHeight * step)+'px) scale('+(1 - step)+')');
					}
					$(this).css('transiton','.3s');
					$li.eq(brotherIndex).css('transition','.3s');
					$li.eq(brotherIndex).css('transform','translate(0,0)');
				})
			});
			$li.on('transitionEnd webkitTransitionEnd',function(ev){
				if($li.is(ev.target)){
					fnResize();
					if(createAnimate[nowIndex]){
						createAnimate[nowIndex].outAnimate();
					}if(createAnimate[brotherIndex]){
						createAnimate[brotherIndex].inAnimate();
					}
				}
			})
			function fnResize(){
				$li.css('transition','');
				$li.eq(brotherIndex).removeClass('zIndex').siblings().hide();
				iBtn = true;
			}
		}
		//场景动画
		var createAnimate = [
			{
				inAnimate : function(){
					var $page = $li.eq(0).find('li');
					$page.css('transition','.5s');
					$page.css('opacity',1);
					$page.css('transform','translate(0,0)');
				},
				outAnimate : function(){
					var $page = $li.eq(0).find('li');
					$page.css('transition','');
					$page.css('opacity',0);
					$page.filter(':even').css('transform','translate(-200px,0)');
					$page.filter(':odd').css('transform','translate(200px,0)');
				}
			},
			{
				inAnimate : function(){
					var $page = $li.eq(1).find('li');
					$page.css('transition','1s');
					$page.attr('class','');
					$page.css('transform','rotateZ(720deg)');
				},
				outAnimate : function(){
					var $page = $li.eq(1).find('li');
					$page.css('transition','');
					$page.attr('class','selected');
					$page.css('transform','rotateZ(0)');
				}
			},
			{
				inAnimate : function(){
					var $page = $li.eq(2).find('div');
					$page.css('transition','1.6s');
					$page.css('transform','rotateY(360deg)');
				},
				outAnimate : function(){
					var $page = $li.eq(2).find('div');
					$page.css('transition','');
					$page.css('transform','rotateY(0)');
				}
			},
			{
				inAnimate : function(){
					var $page = $li.eq(3).find('li');
					$page.css('transition','.6s');
					$page.attr('class','');
				},
				outAnimate : function(){
					var $page = $li.eq(3).find('li');
					$page.css('transition','');
					$page.attr('class','active');
				}
			}
		];
		/*createAnimate[3].outAnimate();
		setTimeout(function(){
			createAnimate[3].inAnimate();
		},100);*/

		$.each(createAnimate,function(i,obj){
			obj.outAnimate();
		});

		//加载音乐
		function loadMusic(){
			
			var iBtn = true;

			$music.on('touchstart',function(){
				if(iBtn){
					$audio.get(0).play();
					$music.attr('class','roll');
				}else{
					$audio.get(0).pause();
					$music.attr('class','');
				}
				iBtn = !iBtn;
			});
			$audio.trigger('touchstart');
		}

		//加载资源
		function loadingSource(){
			var arrSource = ['a.png','c.png','d.png','e.png','ad1.png','ad2.png','ad3.png','ad4.png','c1.png','c2.png','c3.png','c4.png','c5.png','c6.png','d1.png','b.png'];
			var $loading = $('#loading');
			var iNum = 0;
			
			for(var i = 0; i < arrSource.length; i++){
				var objImg = new Image();
				objImg.src = 'img/'+arrSource[i]+'';
				
				objImg.onload = function(){
					iNum++;
					if(iNum == arrSource.length){
						$loading.animate({opacity : 0},1000,function(){
							$li.eq(0).show();
							$music.show();
							$(this).remove();
						});
					}
				}
				objImg.onerror = function(){
					$loading.animate({opacity : 0},function(){
						$li.eq(0).show();
						$music.show();
						$(this).remove();
					});
				}
			}
			
		}

	});
	</script>
</head>
<body>
	<div id="main">
		<div id="loading">
			<ul>
				<li></li>
				<li></li>
				<li></li>
				<li></li>
				<li></li>
				<li></li>
			</ul>
			<p>你的技能是否已载满……</p>
		</div>
		<canvas id="c1" width="640" height="960"></canvas>
		<ul id="list">
			<li>
				<ul class="page1">
					<li>
						<p>曾经做为前端开发的你</p>
						<p>解决PC兼容性而焦头烂额</p>
					</li>
					<li>
						<p>而今</p>
						<p>移动端H5应用疯狂来袭</p>
					</li>
					<li>
						<p>你是否已准备充分</p>
						<p>学习新技能</p>
					</li>
					<li>
						<p>曾破茧成蝶、重获新生？</p>
						<p>学习新技能</p>
					</li>
				</ul>
			</li>
			<li>
				<ul class="page2">
					<li></li>
					<li></li>
					<li></li>
					<li></li>
					<li></li>
					<li></li>
				</ul>
			</li>
			<li>
				<div class="page3"></div>
			</li>
			<li>
				<ul class="page4">
					<li>transform  transition  rotate  scale  translate  keyframes animation  webkitTransitionEnd webkitAnimationIteration elapsedTime perspective…</li>
           			<li>drawImage lineWidth  strokeStyle  lineCap  globalCompositeOperation  moveTo   lineTo  stroke  arc  getImageData…</li>
            		<li>audio autoplay loop  paused  play  pause…</li>
				</ul>
			</li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
		</ul>
		<div id="arrow"></div>
		<div id="music">
			<audio id="audio1" loop>
				<source src="http://www.ikoumi.com/yunpan/cFZbNY3zw4ce2/8309.mp3"></source>
				<source src="img/music.mp3"></source>
			</audio>
		</div>
	</div>
</body>
</html>